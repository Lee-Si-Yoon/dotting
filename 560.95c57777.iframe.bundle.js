"use strict";(self.webpackChunkdotting=self.webpackChunkdotting||[]).push([[560],{"./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}__webpack_require__.d(__webpack_exports__,{Z:()=>_arrayLikeToArray})},"./node_modules/@babel/runtime/helpers/esm/objectSpread2.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>_objectSpread2});var toPropertyKey=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js");function _defineProperty(obj,key,value){return(key=(0,toPropertyKey.Z)(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}},"./node_modules/@babel/runtime/helpers/esm/slicedToArray.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>_slicedToArray});var unsupportedIterableToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js");function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_x,_r,_arr=[],_n=!0,_d=!1;try{if(_x=(_i=_i.call(arr)).next,0===i){if(Object(_i)!==_i)return;_n=!1}else for(;!(_n=(_s=_x.call(_i)).done)&&(_arr.push(_s.value),_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{if(!_n&&null!=_i.return&&(_r=_i.return(),Object(_r)!==_r))return}finally{if(_d)throw _e}}return _arr}}(arr,i)||(0,unsupportedIterableToArray.Z)(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},"./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>_toPropertyKey});var esm_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/typeof.js");function _toPropertyKey(arg){var key=function _toPrimitive(input,hint){if("object"!==(0,esm_typeof.Z)(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0!==prim){var res=prim.call(input,hint||"default");if("object"!==(0,esm_typeof.Z)(res))return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===hint?String:Number)(input)}(arg,"string");return"symbol"===(0,esm_typeof.Z)(key)?key:String(key)}},"./node_modules/@babel/runtime/helpers/esm/typeof.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}__webpack_require__.d(__webpack_exports__,{Z:()=>_typeof})},"./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>_unsupportedIterableToArray});var _arrayLikeToArray_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js");function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return(0,_arrayLikeToArray_js__WEBPACK_IMPORTED_MODULE_0__.Z)(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,_arrayLikeToArray_js__WEBPACK_IMPORTED_MODULE_0__.Z)(o,minLen):void 0}}},"./src/components/Canvas/types.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var CanvasEvents,BrushMode;__webpack_require__.d(__webpack_exports__,{S:()=>BrushMode,v:()=>CanvasEvents}),function(CanvasEvents){CanvasEvents.DATA_CHANGE="dataChange",CanvasEvents.GRID_CHANGE="gridChange",CanvasEvents.STROKE_END="strokeEnd",CanvasEvents.BRUSH_CHANGE="brushChange"}(CanvasEvents||(CanvasEvents={})),function(BrushMode){BrushMode.DOT="dot",BrushMode.ERASER="eraser"}(BrushMode||(BrushMode={}))},"./src/components/Dotting.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>components_Dotting});var arrayLikeToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js");var unsupportedIterableToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js");function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return(0,arrayLikeToArray.Z)(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||(0,unsupportedIterableToArray.Z)(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/react/index.js");var objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var toPropertyKey=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js");function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,(0,toPropertyKey.Z)(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}var setPrototypeOf=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js");var getPrototypeOf=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),isNativeReflectConstruct=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/isNativeReflectConstruct.js"),esm_typeof=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/typeof.js"),assertThisInitialized=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js");function _createSuper(Derived){var hasNativeReflectConstruct=(0,isNativeReflectConstruct.Z)();return function _createSuperInternal(){var result,Super=(0,getPrototypeOf.Z)(Derived);if(hasNativeReflectConstruct){var NewTarget=(0,getPrototypeOf.Z)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return function _possibleConstructorReturn(self,call){if(call&&("object"===(0,esm_typeof.Z)(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return(0,assertThisInitialized.Z)(self)}(this,result)}}var convertCartesianToScreen=function convertCartesianToScreen(canvas,cartesianCoord,dpr){return{x:cartesianCoord.x+canvas.width/dpr/2,y:cartesianCoord.y+canvas.height/dpr/2}};function diffPoints(p1,p2){return{x:p1.x-p2.x,y:p1.y-p2.y}}function addPoints(p1,p2){return{x:p1.x+p2.x,y:p1.y+p2.y}}function getScreenPoint(point,panZoom){var offset=panZoom.offset,scale=panZoom.scale;return{x:Math.floor(point.x*scale+offset.x),y:Math.floor(point.y*scale+offset.y)}}function getWorldPoint(point,panZoom){var offset=panZoom.offset,scale=panZoom.scale;return{x:(point.x-offset.x)/scale,y:(point.y-offset.y)/scale}}var Event=function(){function Event(name){_classCallCheck(this,Event),this.name=void 0,this.callbacks=void 0,this.name=name,this.callbacks=[]}return _createClass(Event,[{key:"on",value:function on(cb){this.callbacks.push(cb)}},{key:"off",value:function off(cb){var idx=this.callbacks.findIndex((function(callback){return callback===cb}));this.callbacks.splice(idx,1)}},{key:"toString",value:function toString(){return this.name}}]),Event}(),EventDispatcher=function(){function EventDispatcher(){_classCallCheck(this,EventDispatcher),this.events=void 0,this.events={}}return _createClass(EventDispatcher,[{key:"emit",value:function emit(name){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];this.events[name]&&this.events[name].callbacks.forEach((function(cb){cb.apply(void 0,args)}))}},{key:"addEventListener",value:function addEventListener(name,cb){this.events[name]||(this.events[name]=new Event(name)),this.events[name].on(cb)}},{key:"removeEventListener",value:function removeEventListener(name,cb){cb?this.events[name].off(cb):delete this.events[name]}}]),EventDispatcher}(),types=__webpack_require__("./src/components/Canvas/types.ts");function addEvent(el,type,fn,capturing){return el.addEventListener(type,fn,capturing)}function removeEvent(el,type,fn,capturing){return el.removeEventListener(type,fn,capturing)}var MouseMode,ButtonDirection,touch={mouseup:"touchend",mouseout:"touchend",mousedown:"touchstart",mousemove:"touchmove"};function touchy(el,event,type,fn){event(el,touch[type],fn),event(el,type,fn)}!function(MouseMode){MouseMode.DRAWING="DRAWING",MouseMode.PANNING="PANNING",MouseMode.EXTENDING="EXTENDING",MouseMode.NULL="NULL"}(MouseMode||(MouseMode={})),function(ButtonDirection){ButtonDirection.TOP="TOP",ButtonDirection.BOTTOM="BOTTOM",ButtonDirection.LEFT="LEFT",ButtonDirection.RIGHT="RIGHT",ButtonDirection.NULL="NULL"}(ButtonDirection||(ButtonDirection={}));var Canvas=function(_EventDispatcher){!function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&(0,setPrototypeOf.Z)(subClass,superClass)}(Canvas,_EventDispatcher);var _super=_createSuper(Canvas);function Canvas(canvas,initData,isPanZoomable,isGridVisible,isGridFixed,initBrushColor,initIndicatorData){var _this;_classCallCheck(this,Canvas),(_this=_super.call(this)).MAX_SCALE=1.5,_this.MIN_SCALE=.3,_this.ZOOM_SENSITIVITY=200,_this.buttonHeight=20,_this.buttonMargin=_this.buttonHeight/2+5,_this.element=void 0,_this.gridSquareLength=20,_this.origin={x:0,y:0},_this.pinchZoomPrevDiff=0,_this.isPanZoomable=void 0,_this.isGridFixed=void 0,_this.isGridVisible=void 0,_this.strokedPixels=[],_this.indicatorPixels=[],_this.mouseMode=MouseMode.NULL,_this.hoveredButton=null,_this.brushColor=void 0,_this.brushMode=types.S.DOT,_this.data=new Map,_this.hoveredPixel=null,_this.panZoom={scale:1,offset:_this.origin},_this.panPoint={lastMousePos:_this.origin},_this.extensionPoint={lastMousePos:_this.origin,direction:null},_this.width=0,_this.height=0,_this.dpr=1,_this.ctx=void 0,_this.handleExtension=function(evt){evt.preventDefault();var minAmountForExtension=_this.gridSquareLength/2;if(!(window.TouchEvent&&evt instanceof TouchEvent&&evt.touches.length>1)){var mouseCartCoord=_this.getMouseCartCoord(evt),buttonDirection=_this.extensionPoint.direction,extensionAmount=diffPoints(_this.extensionPoint.lastMousePos,mouseCartCoord);if(buttonDirection){switch(buttonDirection){case ButtonDirection.TOP:extensionAmount.y>minAmountForExtension?(_this.extendGrid(ButtonDirection.TOP),_this.extensionPoint.lastMousePos.y-=_this.gridSquareLength/2):extensionAmount.y<-minAmountForExtension&&(_this.shortenGrid(ButtonDirection.TOP),_this.extensionPoint.lastMousePos.y+=_this.gridSquareLength/2);break;case ButtonDirection.BOTTOM:extensionAmount.y<-minAmountForExtension?(_this.extendGrid(ButtonDirection.BOTTOM),_this.extensionPoint.lastMousePos.y+=_this.gridSquareLength/2):extensionAmount.y>minAmountForExtension&&(_this.shortenGrid(ButtonDirection.BOTTOM),_this.extensionPoint.lastMousePos.y-=_this.gridSquareLength/2);break;case ButtonDirection.LEFT:extensionAmount.x>minAmountForExtension?(_this.extendGrid(ButtonDirection.LEFT),_this.extensionPoint.lastMousePos.x-=_this.gridSquareLength/2):extensionAmount.x<-minAmountForExtension&&(_this.shortenGrid(ButtonDirection.LEFT),_this.extensionPoint.lastMousePos.x+=_this.gridSquareLength/2);break;case ButtonDirection.RIGHT:extensionAmount.x<-minAmountForExtension?(_this.extendGrid(ButtonDirection.RIGHT),_this.extensionPoint.lastMousePos.x+=_this.gridSquareLength/2):extensionAmount.x>minAmountForExtension&&(_this.shortenGrid(ButtonDirection.RIGHT),_this.extensionPoint.lastMousePos.x-=_this.gridSquareLength/2)}_this.render()}}},_this.handlePanning=function(evt){if(_this.isPanZoomable){var lastMousePos=_this.panPoint.lastMousePos;if(!(window.TouchEvent&&evt instanceof TouchEvent&&evt.touches.length>1)){var point=_this.getPointFromTouchyEvent(evt),currentMousePos={x:point.offsetX,y:point.offsetY};_this.panPoint.lastMousePos=currentMousePos;var mouseDiff=diffPoints(lastMousePos,currentMousePos),offset=diffPoints(_this.panZoom.offset,mouseDiff);_this.setPanZoom({offset})}}},_this.returnScrollOffsetFromMouseOffset=function(mouseOffset,panZoom,newScale){var scaleOffset=diffPoints(mouseOffset,getScreenPoint(getWorldPoint(mouseOffset,panZoom),{scale:newScale,offset:panZoom.offset}));return addPoints(panZoom.offset,scaleOffset)},_this.handleWheel=function(e){if(e.preventDefault(),_this.isPanZoomable)if(e.ctrlKey){var zoom=1-e.deltaY/_this.ZOOM_SENSITIVITY,newScale=_this.panZoom.scale*zoom;newScale>_this.MAX_SCALE&&(newScale=_this.MAX_SCALE),newScale<_this.MIN_SCALE&&(newScale=_this.MIN_SCALE);var mouseOffset={x:e.offsetX,y:e.offsetY},newOffset=_this.returnScrollOffsetFromMouseOffset(mouseOffset,_this.panZoom,newScale);_this.setPanZoom({scale:newScale,offset:newOffset})}else{var offset=diffPoints(_this.panZoom.offset,{x:e.deltaX,y:e.deltaY});_this.setPanZoom((0,objectSpread2.Z)((0,objectSpread2.Z)({},_this.panZoom),{},{offset}))}},_this.handlePinchZoom=function(evt){if(evt.preventDefault(),_this.isPanZoomable&&window.TouchEvent&&evt instanceof TouchEvent){var touchCount=evt.touches.length;if(touchCount<2)return;for(var canvasTouchEventIndexes=[],i=0;i<touchCount;i++){evt.touches.item(i).target instanceof HTMLCanvasElement&&canvasTouchEventIndexes.push(i)}if(2!==canvasTouchEventIndexes.length)return;var firstTouch=evt.touches[canvasTouchEventIndexes[0]],secondTouch=evt.touches[canvasTouchEventIndexes[1]],pinchZoomCurrentDiff=Math.abs(firstTouch.clientX-secondTouch.clientX)+Math.abs(firstTouch.clientY-secondTouch.clientY),firstTouchPoint=_this.getPointFromTouch(firstTouch),secondTouchPoint=_this.getPointFromTouch(secondTouch),touchCenterPos={x:(firstTouchPoint.offsetX+secondTouchPoint.offsetY)/2,y:(firstTouchPoint.offsetY+secondTouchPoint.offsetY)/2};if(!_this.pinchZoomPrevDiff)return void(_this.pinchZoomPrevDiff=pinchZoomCurrentDiff);var zoom=1-2*(_this.pinchZoomPrevDiff-pinchZoomCurrentDiff)/_this.ZOOM_SENSITIVITY,newScale=_this.panZoom.scale*zoom;if(_this.MIN_SCALE>newScale||newScale>_this.MAX_SCALE)return;var scaleOffset=diffPoints(touchCenterPos,getScreenPoint(getWorldPoint(touchCenterPos,{scale:_this.panZoom.scale,offset:_this.panZoom.offset}),{scale:newScale,offset:_this.panZoom.offset})),offset=addPoints(_this.panZoom.offset,scaleOffset);_this.setPanZoom({offset,scale:newScale}),_this.pinchZoomPrevDiff=pinchZoomCurrentDiff}},_this.element=canvas,_this.ctx=canvas.getContext("2d"),_this.isPanZoomable=isPanZoomable||!0,_this.isGridFixed=isGridFixed||!1,_this.isGridVisible=isGridVisible||!0,_this.brushColor=initBrushColor||"#FF0000",_this.indicatorPixels=initIndicatorData||[];var isInitDataValid=!0;if(initData){var initRowCount=initData.length;if(initRowCount<2)isInitDataValid=!1;else{var initColumnCount=initData[0].length;if(initColumnCount<2)isInitDataValid=!1;else for(var i=0;i<initRowCount;i++)if(initData[i].length!==initColumnCount){isInitDataValid=!1;break}}}return _this.initialize(isInitDataValid?initData:void 0),_this}return _createClass(Canvas,[{key:"setCanvasData",value:function setCanvasData(data){this.data=data,this.render()}},{key:"setIndicatorPixels",value:function setIndicatorPixels(indicatorPixels){this.indicatorPixels=indicatorPixels,this.render()}},{key:"setIsGridVisible",value:function setIsGridVisible(isGridVisible){void 0!==isGridVisible&&(this.isGridVisible=isGridVisible),this.render()}},{key:"setIsGridFixed",value:function setIsGridFixed(isGridFixed){void 0!==isGridFixed&&(this.isGridFixed=isGridFixed),this.render()}},{key:"setIsPanZoomable",value:function setIsPanZoomable(isPanZoomable){void 0!==isPanZoomable&&(this.isPanZoomable=isPanZoomable)}},{key:"detectMouseOnButton",value:function detectMouseOnButton(coord){var gridsHeight=this.gridSquareLength*this.getRowCount(),gridsWidth=this.gridSquareLength*this.getColumnCount(),topButtonPos={x:-gridsWidth/2,y:-gridsHeight/2-this.buttonMargin-this.buttonHeight/2},bottomButtonPos={x:-gridsWidth/2,y:gridsHeight/2+this.buttonMargin-this.buttonHeight/2},leftButtonPos={x:-gridsWidth/2-this.buttonMargin-this.buttonHeight/2,y:-gridsHeight/2},rightButtonPos={x:gridsWidth/2+this.buttonMargin-this.buttonHeight/2,y:-gridsHeight/2},x=coord.x,y=coord.y,topButtonRect_x=topButtonPos.x,topButtonRect_y=topButtonPos.y,topButtonRect_width=gridsWidth,topButtonRect_height=this.buttonHeight,bottomButtonRect_x=bottomButtonPos.x,bottomButtonRect_y=bottomButtonPos.y,bottomButtonRect_width=gridsWidth,bottomButtonRect_height=this.buttonHeight,leftButtonRect_x=leftButtonPos.x,leftButtonRect_y=leftButtonPos.y,leftButtonRect_width=this.buttonHeight,leftButtonRect_height=gridsHeight,rightButtonRect_x=rightButtonPos.x,rightButtonRect_y=rightButtonPos.y,rightButtonRect_width=this.buttonHeight,rightButtonRect_height=gridsHeight;return x>=topButtonRect_x&&x<=topButtonRect_x+topButtonRect_width&&y>=topButtonRect_y&&y<=topButtonRect_y+topButtonRect_height?ButtonDirection.TOP:x>=bottomButtonRect_x&&x<=bottomButtonRect_x+bottomButtonRect_width&&y>=bottomButtonRect_y&&y<=bottomButtonRect_y+bottomButtonRect_height?ButtonDirection.BOTTOM:x>=leftButtonRect_x&&x<=leftButtonRect_x+leftButtonRect_width&&y>=leftButtonRect_y&&y<=leftButtonRect_y+leftButtonRect_height?ButtonDirection.LEFT:x>=rightButtonRect_x&&x<=rightButtonRect_x+rightButtonRect_width&&y>=rightButtonRect_y&&y<=rightButtonRect_y+rightButtonRect_height?ButtonDirection.RIGHT:null}},{key:"detectButtonClicked",value:function detectButtonClicked(coord){return this.detectMouseOnButton(coord)}},{key:"drawTopButton",value:function drawTopButton(opacity){var gridsWidth=this.gridSquareLength*this.getColumnCount(),gridsHeight=this.gridSquareLength*this.getRowCount(),ctx=this.ctx;ctx.save();var buttonPos={x:-gridsWidth/2,y:-gridsHeight/2-this.buttonMargin},correctedScreenPoint=getScreenPoint(convertCartesianToScreen(this.element,buttonPos,this.dpr),this.panZoom);ctx.fillStyle="#E1DFE1",ctx.globalAlpha=opacity,ctx.fillRect(correctedScreenPoint.x,correctedScreenPoint.y-this.buttonHeight/2*this.panZoom.scale,gridsWidth*this.panZoom.scale,this.buttonHeight*this.panZoom.scale),ctx.restore(),this.drawArrowHead(ctx,correctedScreenPoint.x+gridsWidth*this.panZoom.scale/2,correctedScreenPoint.y-this.buttonHeight/2*this.panZoom.scale,2*Math.PI,this.panZoom.scale,opacity),this.drawArrowHead(ctx,correctedScreenPoint.x+gridsWidth*this.panZoom.scale/2,correctedScreenPoint.y+this.buttonHeight/2*this.panZoom.scale,Math.PI,this.panZoom.scale,opacity)}},{key:"drawBottomButton",value:function drawBottomButton(opacity){var ctx=this.ctx;ctx.save();var gridsWidth=this.gridSquareLength*this.getColumnCount(),buttonPos={x:-gridsWidth/2,y:this.gridSquareLength*this.getRowCount()/2+this.buttonMargin},correctedScreenPoint=getScreenPoint(convertCartesianToScreen(this.element,buttonPos,this.dpr),this.panZoom);ctx.fillStyle="#E1DFE1",ctx.globalAlpha=opacity,ctx.fillRect(correctedScreenPoint.x,correctedScreenPoint.y-this.buttonHeight/2*this.panZoom.scale,gridsWidth*this.panZoom.scale,this.buttonHeight*this.panZoom.scale),ctx.restore(),this.drawArrowHead(ctx,correctedScreenPoint.x+gridsWidth*this.panZoom.scale/2,correctedScreenPoint.y-this.buttonHeight/2*this.panZoom.scale,2*Math.PI,this.panZoom.scale,opacity),this.drawArrowHead(ctx,correctedScreenPoint.x+gridsWidth*this.panZoom.scale/2,correctedScreenPoint.y+this.buttonHeight/2*this.panZoom.scale,Math.PI,this.panZoom.scale,opacity)}},{key:"drawArrowHead",value:function drawArrowHead(ctx,x,y,radians,scale,opacity){ctx.save(),ctx.beginPath(),ctx.translate(x,y),ctx.rotate(radians),ctx.moveTo(0,0),ctx.lineTo(10*scale,6*scale),ctx.lineTo(-10*scale,6*scale),ctx.closePath(),ctx.globalAlpha=opacity,ctx.fillStyle="#bbbbbb",ctx.fill(),ctx.restore()}},{key:"drawLeftButton",value:function drawLeftButton(opacity){var ctx=this.ctx;ctx.save();var gridsWidth=this.gridSquareLength*this.getColumnCount(),gridsHeight=this.gridSquareLength*this.getRowCount(),buttonPos={x:-gridsWidth/2-this.buttonMargin,y:-gridsHeight/2},correctedScreenPoint=getScreenPoint(convertCartesianToScreen(this.element,buttonPos,this.dpr),this.panZoom);ctx.fillStyle="#E1DFE1",ctx.globalAlpha=opacity,ctx.fillRect(correctedScreenPoint.x-this.buttonHeight/2*this.panZoom.scale,correctedScreenPoint.y,this.buttonHeight*this.panZoom.scale,gridsHeight*this.panZoom.scale),ctx.restore(),this.drawArrowHead(ctx,correctedScreenPoint.x-this.buttonHeight/2*this.panZoom.scale,correctedScreenPoint.y+gridsHeight*this.panZoom.scale/2,-Math.PI/2,this.panZoom.scale,opacity),this.drawArrowHead(ctx,correctedScreenPoint.x+this.buttonHeight/2*this.panZoom.scale,correctedScreenPoint.y+gridsHeight*this.panZoom.scale/2,Math.PI/2,this.panZoom.scale,opacity)}},{key:"drawRightButton",value:function drawRightButton(opacity){var ctx=this.ctx;ctx.save();var gridsWidth=this.gridSquareLength*this.getColumnCount(),gridsHeight=this.gridSquareLength*this.getRowCount(),buttonPos={x:gridsWidth/2+this.buttonMargin,y:-gridsHeight/2},correctedScreenPoint=getScreenPoint(convertCartesianToScreen(this.element,buttonPos,this.dpr),this.panZoom);ctx.fillStyle="#E1DFE1",ctx.globalAlpha=opacity,ctx.fillRect(correctedScreenPoint.x-this.buttonHeight/2*this.panZoom.scale,correctedScreenPoint.y,this.buttonHeight*this.panZoom.scale,gridsHeight*this.panZoom.scale),ctx.restore(),this.drawArrowHead(ctx,correctedScreenPoint.x-this.buttonHeight/2*this.panZoom.scale,correctedScreenPoint.y+gridsHeight*this.panZoom.scale/2,-Math.PI/2,this.panZoom.scale,opacity),this.drawArrowHead(ctx,correctedScreenPoint.x+this.buttonHeight/2*this.panZoom.scale,correctedScreenPoint.y+gridsHeight*this.panZoom.scale/2,Math.PI/2,this.panZoom.scale,opacity)}},{key:"drawButtons",value:function drawButtons(){this.drawTopButton(this.hoveredButton===ButtonDirection.TOP?.8:.4),this.drawBottomButton(this.hoveredButton===ButtonDirection.BOTTOM?.8:.4),this.drawLeftButton(this.hoveredButton===ButtonDirection.LEFT?.8:.4),this.drawRightButton(this.hoveredButton===ButtonDirection.RIGHT?.8:.4)}},{key:"drawRects",value:function drawRects(){var _this2=this,squareLength=this.gridSquareLength*this.panZoom.scale,leftTopPoint={x:-this.getColumnCount()/2*this.gridSquareLength,y:-this.getRowCount()/2*this.gridSquareLength},ctx=this.ctx,correctedLeftTopScreenPoint=getScreenPoint(convertCartesianToScreen(this.element,leftTopPoint,this.dpr),this.panZoom),allRowKeys=Array.from(this.data.keys()),allColumnKeys=Array.from(this.data.get(allRowKeys[0]).keys()),currentTopIndex=Math.min.apply(Math,allRowKeys),currentLeftIndex=Math.min.apply(Math,allColumnKeys);ctx.save();for(var i=0;i<this.getRowCount();i++)for(var _loop=function _loop(){var _this2$data$get,_this2$data$get$get,rowIndex=i+currentTopIndex,columnIndex=j+currentLeftIndex,color=null===(_this2$data$get=_this2.data.get(rowIndex))||void 0===_this2$data$get||null===(_this2$data$get$get=_this2$data$get.get(columnIndex))||void 0===_this2$data$get$get?void 0:_this2$data$get$get.color;if(0!==_this2.indicatorPixels.length){var indicator=_this2.indicatorPixels.find((function(pixel){return pixel.rowIndex===rowIndex&&pixel.columnIndex===columnIndex}));if(indicator){var relativeRowIndex=rowIndex-currentTopIndex,relativeColumnIndex=columnIndex-currentLeftIndex;ctx.save(),ctx.fillStyle=indicator.color,ctx.globalAlpha=.5,ctx.fillRect(relativeColumnIndex*squareLength+correctedLeftTopScreenPoint.x,relativeRowIndex*squareLength+correctedLeftTopScreenPoint.y,squareLength,squareLength),ctx.restore()}}if(_this2.hoveredPixel&&_this2.hoveredPixel.rowIndex===rowIndex&&_this2.hoveredPixel.columnIndex===columnIndex){ctx.save();var _this2$hoveredPixel=_this2.hoveredPixel,_rowIndex=_this2$hoveredPixel.rowIndex,_columnIndex=_this2$hoveredPixel.columnIndex,_relativeRowIndex=_rowIndex-currentTopIndex,_relativeColumnIndex=_columnIndex-currentLeftIndex;if(_this2.brushMode!==types.S.ERASER)return ctx.globalAlpha=.5,ctx.fillStyle=_this2.brushColor,color===_this2.brushColor&&(ctx.globalAlpha=1),ctx.fillRect(_relativeColumnIndex*squareLength+correctedLeftTopScreenPoint.x,_relativeRowIndex*squareLength+correctedLeftTopScreenPoint.y,squareLength,squareLength),ctx.restore(),"continue";if(color)return ctx.globalAlpha=.2,ctx.fillStyle=color,ctx.fillRect(_relativeColumnIndex*squareLength+correctedLeftTopScreenPoint.x,_relativeRowIndex*squareLength+correctedLeftTopScreenPoint.y,squareLength,squareLength),ctx.restore(),"continue";ctx.restore()}if(!color)return"continue";ctx.fillStyle=color,ctx.fillRect(j*squareLength+correctedLeftTopScreenPoint.x,i*squareLength+correctedLeftTopScreenPoint.y,squareLength,squareLength)},j=0;j<this.getColumnCount();j++)_loop();ctx.restore()}},{key:"drawGrids",value:function drawGrids(){var squareLength=this.gridSquareLength*this.panZoom.scale,leftTopPoint={x:-this.getColumnCount()/2*this.gridSquareLength,y:-this.getRowCount()/2*this.gridSquareLength},ctx=this.ctx,correctedScreenPoint=getScreenPoint(convertCartesianToScreen(this.element,leftTopPoint,this.dpr),this.panZoom);ctx.save(),ctx.lineWidth=1;for(var i=0;i<=this.getColumnCount();i++)ctx.beginPath(),ctx.moveTo(correctedScreenPoint.x+i*squareLength,correctedScreenPoint.y),ctx.lineTo(correctedScreenPoint.x+i*squareLength,correctedScreenPoint.y+this.getRowCount()*squareLength),ctx.stroke(),ctx.closePath();for(var j=0;j<=this.getRowCount();j++)ctx.beginPath(),ctx.moveTo(correctedScreenPoint.x,correctedScreenPoint.y+j*squareLength),ctx.lineTo(correctedScreenPoint.x+this.getColumnCount()*squareLength,correctedScreenPoint.y+j*squareLength),ctx.stroke(),ctx.closePath();ctx.restore()}},{key:"getData",value:function getData(){return this.data}},{key:"getDataArray",value:function getDataArray(){for(var dataArray=[],allRows=Array.from(this.data.entries()),i=0;i<allRows.length;i++){var columnPixels=Array.from(allRows[i][1]).map((function(element){return element[1]}));dataArray.push(columnPixels)}return dataArray}},{key:"getGridIndices",value:function getGridIndices(){var allRowKeys=Array.from(this.data.keys()),allColumnKeys=Array.from(this.data.get(allRowKeys[0]).keys()),currentTopIndex=Math.min.apply(Math,allRowKeys),currentLeftIndex=Math.min.apply(Math,allColumnKeys);return{topRowIndex:currentTopIndex,bottomRowIndex:currentTopIndex+allRowKeys.length-1,leftColumnIndex:currentLeftIndex,rightColumnIndex:currentLeftIndex+allColumnKeys.length-1}}},{key:"getDimensions",value:function getDimensions(){return{columnCount:this.getColumnCount(),rowCount:this.getRowCount()}}},{key:"erasePixels",value:function erasePixels(data){for(var currentCanvasIndices=this.getGridIndices(),validData=data.filter((function(change){var rowIndex=change.rowIndex,columnIndex=change.columnIndex;return rowIndex>=currentCanvasIndices.topRowIndex&&rowIndex<=currentCanvasIndices.bottomRowIndex&&columnIndex>=currentCanvasIndices.leftColumnIndex&&columnIndex<=currentCanvasIndices.rightColumnIndex})),i=0;i<validData.length;i++){var _validData$i=validData[i],rowIndex=_validData$i.rowIndex,columnIndex=_validData$i.columnIndex;this.data.get(rowIndex).set(columnIndex,{color:""})}this.render()}},{key:"colorPixels",value:function colorPixels(data){var rowIndices=data.map((function(change){return change.rowIndex})),columnIndices=data.map((function(change){return change.columnIndex})),minRowIndex=Math.min.apply(Math,_toConsumableArray(rowIndices)),maxRowIndex=Math.max.apply(Math,_toConsumableArray(rowIndices)),minColumnIndex=Math.min.apply(Math,_toConsumableArray(columnIndices)),maxColumnIndex=Math.min.apply(Math,_toConsumableArray(columnIndices)),currentCanvasIndices=this.getGridIndices();if(minRowIndex<currentCanvasIndices.topRowIndex)for(var index=currentCanvasIndices.topRowIndex-1;minRowIndex<=index;index--)this.extendGrid(ButtonDirection.TOP);if(maxRowIndex>currentCanvasIndices.bottomRowIndex)for(var _index=currentCanvasIndices.bottomRowIndex+1;maxRowIndex>=_index;_index++)this.extendGrid(ButtonDirection.BOTTOM);if(minColumnIndex<currentCanvasIndices.leftColumnIndex)for(var _index2=currentCanvasIndices.leftColumnIndex-1;minColumnIndex<=_index2;_index2--)this.extendGrid(ButtonDirection.LEFT);if(maxColumnIndex>currentCanvasIndices.rightColumnIndex)for(var _index3=currentCanvasIndices.rightColumnIndex+1;maxColumnIndex>=_index3;_index3++)this.extendGrid(ButtonDirection.RIGHT);var _step,_iterator=function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=(0,unsupportedIterableToArray.Z)(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}(data);try{for(_iterator.s();!(_step=_iterator.n()).done;){var change=_step.value;this.data.get(change.rowIndex).set(change.columnIndex,{color:change.color})}}catch(err){_iterator.e(err)}finally{_iterator.f()}this.emit(types.v.DATA_CHANGE,this.data),this.render()}},{key:"reset",value:function reset(){this.scale(1,1),this.panZoom={scale:1,offset:this.origin},this.clear()}},{key:"getContext",value:function getContext(){return this.ctx}},{key:"getPanZoom",value:function getPanZoom(){return this.panZoom}},{key:"getCanvasElement",value:function getCanvasElement(){return this.element}},{key:"getDpr",value:function getDpr(){return this.dpr}},{key:"initialize",value:function initialize(initData){if(this.emit=this.emit.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),touchy(this.element,addEvent,"mousedown",this.onMouseDown),touchy(this.element,addEvent,"mouseup",this.onMouseUp),touchy(this.element,addEvent,"mouseout",this.onMouseOut),touchy(this.element,addEvent,"mousemove",this.onMouseMove),this.element.addEventListener("wheel",this.handleWheel),initData)for(var i=0;i<initData.length;i++){this.data.set(i,new Map);for(var j=0;j<initData[i].length;j++)this.data.get(i).set(j,{color:initData[i][j].color})}else for(var _i=0;_i<6;_i++){this.data.set(_i,new Map);for(var _j=0;_j<8;_j++)this.data.get(_i).set(_j,{color:""})}}},{key:"emitGridEvent",value:function emitGridEvent(){var allRowKeys=Array.from(this.data.keys()),allColumnKeys=Array.from(this.data.get(allRowKeys[0]).keys()),dimensions={columnCount:this.getColumnCount(),rowCount:this.getRowCount()},indices={topRowIndex:Math.min.apply(Math,allRowKeys),bottomRowIndex:Math.max.apply(Math,allRowKeys),leftColumnIndex:Math.min.apply(Math,allColumnKeys),rightColumnIndex:Math.max.apply(Math,allColumnKeys)};this.emit(types.v.GRID_CHANGE,dimensions,indices)}},{key:"emitDataEvent",value:function emitDataEvent(){this.emit(types.v.DATA_CHANGE,this.data)}},{key:"emitBrushChangeEvent",value:function emitBrushChangeEvent(){this.emit(types.v.BRUSH_CHANGE,this.brushColor,this.brushMode)}},{key:"getMouseCartCoord",value:function getMouseCartCoord(evt){evt.preventDefault();var point=this.getPointFromTouchyEvent(evt);return diffPoints(getWorldPoint({x:point.offsetX,y:point.offsetY},this.panZoom),{x:this.element.width/this.dpr/2,y:this.element.height/this.dpr/2})}},{key:"changeBrushColor",value:function changeBrushColor(color){this.brushColor=color,this.emit(types.v.BRUSH_CHANGE,this.brushColor,this.brushMode)}},{key:"changeBrushMode",value:function changeBrushMode(brushMode){this.brushMode=brushMode,this.emit(types.v.BRUSH_CHANGE,this.brushColor,this.brushMode)}},{key:"getPixelIndexFromMouseCartCoord",value:function getPixelIndexFromMouseCartCoord(mouseCartCoord){var leftTopPoint_x=-this.getColumnCount()/2*this.gridSquareLength,leftTopPoint_y=-this.getRowCount()/2*this.gridSquareLength;if(mouseCartCoord.x>leftTopPoint_x&&mouseCartCoord.x<leftTopPoint_x+this.getColumnCount()*this.gridSquareLength&&mouseCartCoord.y>leftTopPoint_y&&mouseCartCoord.y<leftTopPoint_y+this.getRowCount()*this.gridSquareLength){var allRowKeys=Array.from(this.data.keys()),allColumnKeys=Array.from(this.data.get(allRowKeys[0]).keys()),currentTopIndex=Math.min.apply(Math,allRowKeys),currentLeftIndex=Math.min.apply(Math,allColumnKeys);return{rowIndex:currentTopIndex+Math.floor((mouseCartCoord.y-leftTopPoint_y)/this.gridSquareLength),columnIndex:currentLeftIndex+Math.floor((mouseCartCoord.x-leftTopPoint_x)/this.gridSquareLength)}}return null}},{key:"downloadImage",value:function downloadImage(props){var imageCanvas=document.createElement("canvas"),columnCount=this.getColumnCount(),rowCount=this.getRowCount();imageCanvas.width=columnCount*this.gridSquareLength,imageCanvas.height=rowCount*this.gridSquareLength;for(var imageContext=imageCanvas.getContext("2d"),allRowKeys=Array.from(this.data.keys()),allColumnKeys=Array.from(this.data.get(allRowKeys[0]).keys()),currentTopIndex=Math.min.apply(Math,allRowKeys),currentLeftIndex=Math.min.apply(Math,allColumnKeys),i=0;i<rowCount;i++){for(var j=0;j<columnCount;j++){var rowIndex=i+currentTopIndex,columnIndex=j+currentLeftIndex,pixel=this.data.get(rowIndex).get(columnIndex);if(pixel&&pixel.color){var pixelCoord={x:j*this.gridSquareLength,y:i*this.gridSquareLength};imageContext.save(),imageContext.fillStyle=pixel.color,imageContext.fillRect(pixelCoord.x,pixelCoord.y,this.gridSquareLength,this.gridSquareLength),imageContext.restore()}}if(imageContext.save(),imageContext.strokeStyle="#000000",imageContext.lineWidth=1,props&&props.isGridVisible){for(var _i2=0;_i2<=this.getColumnCount();_i2++)imageContext.beginPath(),imageContext.moveTo(_i2*this.gridSquareLength,0),imageContext.lineTo(_i2*this.gridSquareLength,rowCount*this.gridSquareLength),imageContext.stroke(),imageContext.closePath();for(var _j2=0;_j2<=this.getRowCount();_j2++)imageContext.beginPath(),imageContext.moveTo(0,_j2*this.gridSquareLength),imageContext.lineTo(columnCount*this.gridSquareLength,_j2*this.gridSquareLength),imageContext.stroke(),imageContext.closePath()}imageContext.restore()}var anchor=document.createElement("a");anchor.href=imageCanvas.toDataURL("image/png"),anchor.download="dotting.png",anchor.click()}},{key:"drawPixel",value:function drawPixel(rowIndex,columnIndex){this.brushMode===types.S.ERASER?(this.data.get(rowIndex).set(columnIndex,{color:""}),this.emit(types.v.DATA_CHANGE,this.data)):this.brushMode===types.S.DOT&&(0!==this.strokedPixels.length&&this.strokedPixels[this.strokedPixels.length-1].rowIndex===rowIndex&&this.strokedPixels[this.strokedPixels.length-1].columnIndex===columnIndex||this.strokedPixels.push({rowIndex,columnIndex,color:this.brushColor}),this.data.get(rowIndex).get(columnIndex).color!==this.brushColor&&(this.data.get(rowIndex).set(columnIndex,{color:this.brushColor}),this.emit(types.v.DATA_CHANGE,this.data))),this.render()}},{key:"onMouseDown",value:function onMouseDown(evt){evt.preventDefault();var point=this.getPointFromTouchyEvent(evt);this.panPoint.lastMousePos={x:point.offsetX,y:point.offsetY};var mouseCartCoord=this.getMouseCartCoord(evt),pixelIndex=this.getPixelIndexFromMouseCartCoord(mouseCartCoord);if(pixelIndex&&this.drawPixel(pixelIndex.rowIndex,pixelIndex.columnIndex),this.mouseMode=pixelIndex?MouseMode.DRAWING:MouseMode.PANNING,!this.isGridFixed){var buttonDirection=this.detectButtonClicked(mouseCartCoord);buttonDirection&&(this.extensionPoint.lastMousePos={x:mouseCartCoord.x,y:mouseCartCoord.y},this.extensionPoint.direction=buttonDirection,this.mouseMode=MouseMode.EXTENDING,touchy(this.element,addEvent,"mousemove",this.handleExtension))}this.mouseMode===MouseMode.PANNING&&(touchy(this.element,addEvent,"mousemove",this.handlePanning),touchy(this.element,addEvent,"mousemove",this.handlePinchZoom))}},{key:"extendGrid",value:function extendGrid(direction){var currentRowCount=this.getRowCount(),currentColumnCount=this.getColumnCount(),allRowKeys=Array.from(this.data.keys()),allColumnKeys=Array.from(this.data.get(allRowKeys[0]).keys()),currentTopIndex=Math.min.apply(Math,allRowKeys),currentLeftIndex=Math.min.apply(Math,allColumnKeys),currentBottomIndex=currentTopIndex+currentRowCount-1,currentRightIndex=currentLeftIndex+currentColumnCount-1;switch(direction){case ButtonDirection.TOP:var newTopIndex=currentTopIndex-1;this.data.set(newTopIndex,new Map);for(var i=currentLeftIndex;i<=currentRightIndex;i++)this.data.get(newTopIndex).set(i,{color:""});this.setPanZoom({offset:{x:this.panZoom.offset.x,y:this.panZoom.offset.y-this.gridSquareLength/2*this.panZoom.scale}});break;case ButtonDirection.BOTTOM:var newBottomIndex=currentBottomIndex+1;this.data.set(newBottomIndex,new Map);for(var _i3=currentLeftIndex;_i3<=currentRightIndex;_i3++)this.data.get(newBottomIndex).set(_i3,{color:""});this.setPanZoom({offset:{x:this.panZoom.offset.x,y:this.panZoom.offset.y+this.gridSquareLength/2*this.panZoom.scale}});break;case ButtonDirection.LEFT:var newLeftIndex=currentLeftIndex-1;this.data.forEach((function(row){row.set(newLeftIndex,{color:""})})),this.setPanZoom({offset:{x:this.panZoom.offset.x-this.gridSquareLength/2*this.panZoom.scale,y:this.panZoom.offset.y}});break;case ButtonDirection.RIGHT:var newRightIndex=currentRightIndex+1;this.data.forEach((function(row){row.set(newRightIndex,{color:""})})),this.setPanZoom({offset:{x:this.panZoom.offset.x+this.gridSquareLength/2*this.panZoom.scale,y:this.panZoom.offset.y}})}this.emit(types.v.DATA_CHANGE,this.data);var newAllRowKeys=Array.from(this.data.keys()),newAllColumnKeys=Array.from(this.data.get(newAllRowKeys[0]).keys()),dimensions={columnCount:this.getColumnCount(),rowCount:this.getRowCount()},indices={topRowIndex:Math.min.apply(Math,newAllRowKeys),bottomRowIndex:Math.max.apply(Math,newAllRowKeys),leftColumnIndex:Math.min.apply(Math,newAllColumnKeys),rightColumnIndex:Math.max.apply(Math,newAllColumnKeys)};this.emit(types.v.GRID_CHANGE,dimensions,indices),this.render()}},{key:"shortenGrid",value:function shortenGrid(direction){var allRowKeys=Array.from(this.data.keys()),allColumnKeys=Array.from(this.data.get(allRowKeys[0]).keys()),currentTopIndex=Math.min.apply(Math,allRowKeys),currentLeftIndex=Math.min.apply(Math,allColumnKeys),currentBottomIndex=currentTopIndex+this.getRowCount()-1,currentRightIndex=currentLeftIndex+this.getColumnCount()-1;switch(direction){case ButtonDirection.TOP:if(allRowKeys.length<=2)break;this.data.delete(currentTopIndex),this.setPanZoom({offset:{x:this.panZoom.offset.x,y:this.panZoom.offset.y+this.gridSquareLength/2*this.panZoom.scale}});break;case ButtonDirection.BOTTOM:if(allRowKeys.length<=2)break;this.data.delete(currentBottomIndex),this.setPanZoom({offset:{x:this.panZoom.offset.x,y:this.panZoom.offset.y-this.gridSquareLength/2*this.panZoom.scale}});break;case ButtonDirection.LEFT:if(allColumnKeys.length<=2)break;this.data.forEach((function(row){row.delete(currentLeftIndex)})),this.setPanZoom({offset:{x:this.panZoom.offset.x+this.gridSquareLength/2*this.panZoom.scale,y:this.panZoom.offset.y}});break;case ButtonDirection.RIGHT:if(allColumnKeys.length<=2)break;this.data.forEach((function(row){row.delete(currentRightIndex)})),this.setPanZoom({offset:{x:this.panZoom.offset.x-this.gridSquareLength/2*this.panZoom.scale,y:this.panZoom.offset.y}})}this.emit(types.v.DATA_CHANGE,this.data);var newAllRowKeys=Array.from(this.data.keys()),newAllColumnKeys=Array.from(this.data.get(newAllRowKeys[0]).keys()),dimensions={columnCount:this.getColumnCount(),rowCount:this.getRowCount()},indices={topRowIndex:Math.min.apply(Math,newAllRowKeys),bottomRowIndex:Math.max.apply(Math,newAllRowKeys),leftColumnIndex:Math.min.apply(Math,newAllColumnKeys),rightColumnIndex:Math.max.apply(Math,newAllColumnKeys)};this.emit(types.v.GRID_CHANGE,dimensions,indices),this.render()}},{key:"onMouseMove",value:function onMouseMove(evt){evt.preventDefault();var mouseCartCoord=this.getMouseCartCoord(evt),pixelIndex=this.getPixelIndexFromMouseCartCoord(mouseCartCoord);pixelIndex?this.mouseMode===MouseMode.DRAWING?this.drawPixel(pixelIndex.rowIndex,pixelIndex.columnIndex):(this.hoveredPixel=pixelIndex,this.render()):(this.hoveredPixel=null,this.render());var buttonDirection=this.detectMouseOnButton(mouseCartCoord);if(buttonDirection)return this.hoveredButton=buttonDirection,void this.render();this.mouseMode!==MouseMode.EXTENDING&&(this.hoveredButton=null),this.render()}},{key:"removePanListeners",value:function removePanListeners(){touchy(this.element,removeEvent,"mousemove",this.handlePanning),touchy(this.element,removeEvent,"mousemove",this.handlePinchZoom)}},{key:"onMouseUp",value:function onMouseUp(){this.mouseMode=MouseMode.NULL,0!==this.strokedPixels.length&&(this.emit(types.v.STROKE_END,this.strokedPixels,this.data),this.strokedPixels=[]),touchy(this.element,removeEvent,"mousemove",this.handlePanning),touchy(this.element,removeEvent,"mousemove",this.handlePinchZoom),touchy(this.element,removeEvent,"mousemove",this.handleExtension),this.pinchZoomPrevDiff=void 0,this.hoveredButton=null}},{key:"onMouseOut",value:function onMouseOut(){this.mouseMode!==MouseMode.PANNING&&(touchy(this.element,removeEvent,"mousemove",this.handleExtension),touchy(this.element,removeEvent,"mousemove",this.handlePanning),touchy(this.element,removeEvent,"mousemove",this.handlePinchZoom),this.hoveredButton=null)}},{key:"getColumnCount",value:function getColumnCount(){return 0===this.data.size?0:this.data.entries().next().value[1].size}},{key:"getRowCount",value:function getRowCount(){return this.data.size}},{key:"setPanZoom",value:function setPanZoom(param){var scale=param.scale,offset=param.offset;if(scale&&(this.panZoom.scale=scale),offset){var correctedOffset=(0,objectSpread2.Z)({},offset),columnCount=this.data.entries().next().value[1].size,rowCount=this.data.size,isGridRowsBiggerThanCanvas=rowCount*this.gridSquareLength*this.panZoom.scale>this.height,isGridColumnsBiggerThanCanvas=columnCount*this.gridSquareLength*this.panZoom.scale>this.width,minXPosition=isGridColumnsBiggerThanCanvas?this.width-columnCount*this.gridSquareLength*this.panZoom.scale-(this.width-columnCount*this.gridSquareLength)*this.panZoom.scale/2:-(this.width-columnCount*this.gridSquareLength)/2*this.panZoom.scale,minYPosition=isGridRowsBiggerThanCanvas?this.height-rowCount*this.gridSquareLength*this.panZoom.scale-(this.height-rowCount*this.gridSquareLength)*this.panZoom.scale/2:-(this.height-rowCount*this.gridSquareLength)/2*this.panZoom.scale,maxXPosition=isGridColumnsBiggerThanCanvas?-(this.width-columnCount*this.gridSquareLength)/2*this.panZoom.scale:this.width-columnCount*this.gridSquareLength*this.panZoom.scale-(this.width-columnCount*this.gridSquareLength)*this.panZoom.scale/2,maxYPosition=isGridRowsBiggerThanCanvas?rowCount*this.gridSquareLength*this.panZoom.scale/2-this.height/2*this.panZoom.scale:this.height-rowCount*this.gridSquareLength*this.panZoom.scale-(this.height-rowCount*this.gridSquareLength)*this.panZoom.scale/2;correctedOffset.x<minXPosition&&(correctedOffset.x=minXPosition),correctedOffset.y<minYPosition&&(correctedOffset.y=minYPosition),correctedOffset.x>maxXPosition&&(correctedOffset.x=maxXPosition),correctedOffset.y>maxYPosition&&(correctedOffset.y=maxYPosition),this.panZoom.offset=correctedOffset}this.render()}},{key:"setMouseMode",value:function setMouseMode(mode){this.mouseMode=mode}},{key:"getPointFromTouch",value:function getPointFromTouch(touch){var r=this.element.getBoundingClientRect(),originY=touch.clientY,originX=touch.clientX,offsetX=touch.clientX-r.left,offsetY=touch.clientY-r.top;return{x:originX-this.panZoom.offset.x,y:originY-this.panZoom.offset.y,offsetX,offsetY}}},{key:"getPointFromTouchyEvent",value:function getPointFromTouchyEvent(evt){var originY,originX,offsetX,offsetY;if(window.TouchEvent&&evt instanceof TouchEvent){for(var isCanvasTouchIncluded=!1,firstCanvasTouchIndex=0,i=0;i<evt.touches.length;i++){if(evt.touches.item(i).target instanceof HTMLCanvasElement){isCanvasTouchIncluded=!0,firstCanvasTouchIndex=i;break}}return isCanvasTouchIncluded?this.getPointFromTouch(evt.touches[firstCanvasTouchIndex]):this.getPointFromTouch(evt.touches[0])}return originY=evt.clientY,originX=evt.clientX,offsetX=evt.offsetX,offsetY=evt.offsetY,originY+=window.scrollY,originX+=window.scrollX,{y:originY-this.panZoom.offset.y,x:originX-this.panZoom.offset.x,offsetX,offsetY}}},{key:"getWidth",value:function getWidth(){return this.width}},{key:"getHeight",value:function getHeight(){return this.height}},{key:"setWidth",value:function setWidth(width,devicePixelRatio){this.width=width,this.element.width=devicePixelRatio?width*devicePixelRatio:width,this.element.style.width="".concat(width,"px")}},{key:"setHeight",value:function setHeight(height,devicePixelRatio){this.height=height,this.element.height=devicePixelRatio?height*devicePixelRatio:height,this.element.style.height="".concat(height,"px")}},{key:"setSize",value:function setSize(width,height,devicePixelRatio){this.setWidth(width,devicePixelRatio),this.setHeight(height,devicePixelRatio),this.dpr=devicePixelRatio||this.dpr}},{key:"scale",value:function scale(x,y){this.ctx.scale(x,y)}},{key:"roundRect",value:function roundRect(x,y,width,height,radius){var ctx=this.ctx;ctx.save(),ctx.fillStyle="#FF7C7C",ctx.beginPath(),ctx.moveTo(x+radius,y),ctx.arcTo(x+width,y,x+width,y+height,radius),ctx.arcTo(x+width,y+height,x,y+height,radius),ctx.arcTo(x,y+height,x,y,radius),ctx.arcTo(x,y,x+width,y,radius),ctx.closePath(),ctx.fill(),ctx.restore()}},{key:"render",value:function render(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.save(),this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.restore(),this.drawRects(),this.isGridVisible&&this.drawGrids(),this.isGridFixed||this.drawButtons()}},{key:"drawHoveredPixel",value:function drawHoveredPixel(){if(this.hoveredPixel){var _this$hoveredPixel=this.hoveredPixel;_this$hoveredPixel.rowIndex,_this$hoveredPixel.columnIndex;this.ctx.save(),this.ctx.fillStyle=this.brushColor,this.ctx.globalAlpha=.5,this.ctx.restore()}}},{key:"clear",value:function clear(){var rowCount=this.getRowCount(),columnCount=this.getColumnCount();this.data=new Map;for(var i=0;i<rowCount;i++){this.data.set(i,new Map);for(var j=0;j<columnCount;j++)this.data.get(i).set(j,{color:""})}this.render()}},{key:"destroy",value:function destroy(){touchy(this.element,removeEvent,"mouseup",this.onMouseUp),touchy(this.element,removeEvent,"mouseout",this.onMouseOut),touchy(this.element,removeEvent,"mousedown",this.onMouseDown),touchy(this.element,removeEvent,"mousemove",this.onMouseMove),touchy(this.element,removeEvent,"mousemove",this.handlePanning),touchy(this.element,removeEvent,"mousemove",this.handlePinchZoom),this.element.removeEventListener("wheel",this.handleWheel)}}]),Canvas}(EventDispatcher),Dotting=(0,react.forwardRef)((function Dotting(props,ref){var containerRef=(0,react.useRef)(null),_useState=(0,react.useState)(null),_useState2=(0,slicedToArray.Z)(_useState,2),canvas=_useState2[0],setCanvas=_useState2[1],_useState3=(0,react.useState)([]),_useState4=(0,slicedToArray.Z)(_useState3,2),dataChangeListeners=_useState4[0],setDataChangeListeners=_useState4[1],_useState5=(0,react.useState)([]),_useState6=(0,slicedToArray.Z)(_useState5,2),gridChangeListeners=_useState6[0],setGridChangeListeners=_useState6[1],_useState7=(0,react.useState)([]),_useState8=(0,slicedToArray.Z)(_useState7,2),strokeEndListeners=_useState8[0],setStrokeEndListeners=_useState8[1],_useState9=(0,react.useState)([]),_useState10=(0,slicedToArray.Z)(_useState9,2),brushChangeListeners=_useState10[0],setBrushChangeListeners=_useState10[1];(0,react.useEffect)((function(){canvas&&canvas.setIsGridFixed(props.isGridFixed)}),[canvas,props.isGridFixed]),(0,react.useEffect)((function(){canvas&&canvas.setIsGridVisible(props.isGridVisible)}),[canvas,props.isGridVisible]),(0,react.useEffect)((function(){canvas&&canvas.setIsPanZoomable(props.isPanZoomable)}),[canvas,props.isPanZoomable]),(0,react.useEffect)((function(){if(canvas)return gridChangeListeners.forEach((function(listener){canvas.addEventListener(types.v.GRID_CHANGE,listener)})),canvas.emitGridEvent(),function(){gridChangeListeners.forEach((function(listener){null==canvas||canvas.removeEventListener(types.v.GRID_CHANGE,listener)}))}}),[canvas,gridChangeListeners]),(0,react.useEffect)((function(){if(canvas)return dataChangeListeners.forEach((function(listener){canvas.addEventListener(types.v.DATA_CHANGE,listener)})),canvas.emitDataEvent(),function(){dataChangeListeners.forEach((function(listener){null==canvas||canvas.removeEventListener(types.v.DATA_CHANGE,listener)}))}}),[canvas,dataChangeListeners]),(0,react.useEffect)((function(){if(canvas)return brushChangeListeners.forEach((function(listener){canvas.addEventListener(types.v.BRUSH_CHANGE,listener)})),canvas.emitBrushChangeEvent(),function(){brushChangeListeners.forEach((function(listener){null==canvas||canvas.removeEventListener(types.v.BRUSH_CHANGE,listener)}))}}),[canvas,brushChangeListeners]),(0,react.useEffect)((function(){if(canvas)return strokeEndListeners.forEach((function(listener){canvas.addEventListener(types.v.STROKE_END,listener)})),function(){strokeEndListeners.forEach((function(listener){null==canvas||canvas.removeEventListener(types.v.STROKE_END,listener)}))}}),[canvas,strokeEndListeners]),(0,react.useEffect)((function(){var onResize=function onResize(){if(containerRef.current&&canvas){var dpr=window.devicePixelRatio,rect=containerRef.current.getBoundingClientRect();canvas.setSize(rect.width,rect.height,dpr),canvas.scale(dpr,dpr),canvas.render()}};return onResize(),window.addEventListener("resize",onResize),function(){window.removeEventListener("resize",onResize)}}),[canvas,containerRef,props.height,props.width]);var gotRef=(0,react.useCallback)((function(canvasRef){if(canvasRef){var canvas=new Canvas(canvasRef,props.initData,props.isPanZoomable,props.isGridVisible,props.isGridFixed,props.initBrushColor,props.initIndicatorData);setCanvas(canvas)}}),[history]),addDataChangeListener=(0,react.useCallback)((function(listener){setDataChangeListeners((function(listeners){return[].concat(_toConsumableArray(listeners),[listener])}))}),[]),removeDataChangeListener=(0,react.useCallback)((function(listener){canvas.removeEventListener(types.v.DATA_CHANGE,listener),setDataChangeListeners((function(listeners){return listeners.filter((function(l){return l!==listener}))}))}),[canvas]),addGridChangeListener=(0,react.useCallback)((function(listener){setGridChangeListeners((function(listeners){return[].concat(_toConsumableArray(listeners),[listener])}))}),[]),removeGridChangeListener=(0,react.useCallback)((function(listener){canvas.removeEventListener(types.v.GRID_CHANGE,listener),setGridChangeListeners((function(listeners){return listeners.filter((function(l){return l!==listener}))}))}),[canvas]),addBrushChangeListener=(0,react.useCallback)((function(listener){setBrushChangeListeners((function(listeners){return[].concat(_toConsumableArray(listeners),[listener])}))}),[]),removeBrushChangeListener=(0,react.useCallback)((function(listener){canvas.removeEventListener(types.v.BRUSH_CHANGE,listener),setBrushChangeListeners((function(listeners){return listeners.filter((function(l){return l!==listener}))}))}),[canvas]),addStrokeEndListener=(0,react.useCallback)((function(listener){setStrokeEndListeners((function(listeners){return[].concat(_toConsumableArray(listeners),[listener])}))}),[]),removeStrokeEndListener=(0,react.useCallback)((function(listener){canvas.removeEventListener(types.v.STROKE_END,listener),setStrokeEndListeners((function(listeners){return listeners.filter((function(l){return l!==listener}))}))}),[canvas]),addEventListener=(0,react.useCallback)((function(type,listener){null==canvas||canvas.addEventListener(type,listener)}),[canvas]),removeEventListener=(0,react.useCallback)((function(type,listener){null==canvas||canvas.removeEventListener(type,listener)}),[canvas]),clear=(0,react.useCallback)((function(){return null==canvas?void 0:canvas.clear()}),[canvas]),colorPixels=(0,react.useCallback)((function(changes){null==canvas||canvas.colorPixels(changes)}),[canvas]),erasePixels=(0,react.useCallback)((function(changes){null==canvas||canvas.erasePixels(changes)}),[canvas]),setIndicatorPixels=(0,react.useCallback)((function(indicators){null==canvas||canvas.setIndicatorPixels(indicators)}),[canvas]),downloadImage=(0,react.useCallback)((function(options){null==canvas||canvas.downloadImage(options)}),[canvas]),changeBrushColor=(0,react.useCallback)((function(color){null==canvas||canvas.changeBrushColor(color)}),[canvas]),changeBrushMode=(0,react.useCallback)((function(brushMode){null==canvas||canvas.changeBrushMode(brushMode)}),[canvas]);return(0,react.useImperativeHandle)(ref,(function(){return{addEventListener,removeEventListener,setIndicatorPixels,clear,colorPixels,erasePixels,downloadImage,changeBrushColor,changeBrushMode,addDataChangeListener,removeDataChangeListener,addGridChangeListener,removeGridChangeListener,addBrushChangeListener,removeBrushChangeListener,addStrokeEndListener,removeStrokeEndListener}}),[clear]),react.createElement("div",{style:{width:props.width,height:props.height},ref:containerRef},react.createElement("canvas",{ref:gotRef,style:{border:"1px solid black",touchAction:"none"}}))}));const components_Dotting=Dotting;try{ForwardRefExoticComponent.displayName="Dotting",ForwardRefExoticComponent.__docgenInfo={description:"",displayName:"Dotting",props:{width:{defaultValue:null,description:"",name:"width",required:!0,type:{name:"string | number"}},height:{defaultValue:null,description:"",name:"height",required:!0,type:{name:"string | number"}},isGridVisible:{defaultValue:null,description:"",name:"isGridVisible",required:!1,type:{name:"boolean"}},initData:{defaultValue:null,description:"",name:"initData",required:!1,type:{name:"PixelData[][]"}},initIndicatorData:{defaultValue:null,description:"",name:"initIndicatorData",required:!1,type:{name:"PixelModifyItem[]"}},isPanZoomable:{defaultValue:null,description:"",name:"isPanZoomable",required:!1,type:{name:"boolean"}},isGridFixed:{defaultValue:null,description:"",name:"isGridFixed",required:!1,type:{name:"boolean"}},initBrushColor:{defaultValue:null,description:"",name:"initBrushColor",required:!1,type:{name:"string"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"Ref<DottingRef>"}},key:{defaultValue:null,description:"",name:"key",required:!1,type:{name:"Key"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Dotting.tsx#Dotting"]={docgenInfo:Dotting.__docgenInfo,name:"Dotting",path:"src/components/Dotting.tsx#Dotting"})}catch(__react_docgen_typescript_loader_error){}}}]);