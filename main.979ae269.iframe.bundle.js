(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"./generated-stories-entry.js":function(module,exports,__webpack_require__){"use strict";(function(module){(0,__webpack_require__("./node_modules/@storybook/react/dist/esm/client/index.js").configure)([__webpack_require__("./src sync recursive ^\\.(?:(?:^|\\/|(?:(?:(?!(?:^|\\/)\\.).)*?)\\/)(?!\\.)(?=.)[^/]*?\\.stories\\.(js|tsx|mdx))$")],module,!1)}).call(this,__webpack_require__("./node_modules/webpack/buildin/module.js")(module))},"./src sync recursive ^\\.(?:(?:^|\\/|(?:(?:(?!(?:^|\\/)\\.).)*?)\\/)(?!\\.)(?=.)[^/]*?\\.stories\\.(js|tsx|mdx))$":function(module,exports,__webpack_require__){var map={"./components/Dotter.stories.tsx":"./src/components/Dotter.stories.tsx"};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id="./src sync recursive ^\\.(?:(?:^|\\/|(?:(?:(?!(?:^|\\/)\\.).)*?)\\/)(?!\\.)(?=.)[^/]*?\\.stories\\.(js|tsx|mdx))$"},"./src/components/Dotter.stories.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Primary",(function(){return Dotter_stories_Primary}));var react=__webpack_require__("./node_modules/react/index.js"),react_default=__webpack_require__.n(react),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),regeneratorRuntime=(__webpack_require__("./node_modules/core-js/modules/es.map.js"),__webpack_require__("./node_modules/core-js/modules/es.object.to-string.js"),__webpack_require__("./node_modules/core-js/modules/es.string.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.array.iterator.js"),__webpack_require__("./node_modules/core-js/modules/web.dom-collections.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.array.from.js"),__webpack_require__("./node_modules/core-js/modules/es.function.bind.js"),__webpack_require__("./node_modules/core-js/modules/es.array.for-each.js"),__webpack_require__("./node_modules/core-js/modules/web.dom-collections.for-each.js"),__webpack_require__("./node_modules/core-js/modules/es.array.fill.js"),__webpack_require__("./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js")),asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),classCallCheck=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),createClass=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),inherits=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/inherits.js"),createSuper=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createSuper.js"),convertCartesianToScreen=function convertCartesianToScreen(canvas,cartesianCoord,dpr){return{x:cartesianCoord.x+canvas.width/dpr/2,y:cartesianCoord.y+canvas.height/dpr/2}};function diffPoints(p1,p2){return{x:p1.x-p2.x,y:p1.y-p2.y}}function addPoints(p1,p2){return{x:p1.x+p2.x,y:p1.y+p2.y}}function getScreenPoint(point,panZoom){var offset=panZoom.offset,scale=panZoom.scale;return{x:Math.floor(point.x*scale+offset.x),y:Math.floor(point.y*scale+offset.y)}}function getWorldPoint(point,panZoom){var offset=panZoom.offset,scale=panZoom.scale;return{x:(point.x-offset.x)/scale,y:(point.y-offset.y)/scale}}__webpack_require__("./node_modules/core-js/modules/es.function.name.js"),__webpack_require__("./node_modules/core-js/modules/es.array.find-index.js"),__webpack_require__("./node_modules/core-js/modules/es.array.splice.js");var eventDispatcher_Event=function(){function Event(name){Object(classCallCheck.a)(this,Event),this.name=void 0,this.callbacks=void 0,this.name=name,this.callbacks=[]}return Object(createClass.a)(Event,[{key:"on",value:function on(cb){this.callbacks.push(cb)}},{key:"off",value:function off(cb){var idx=this.callbacks.findIndex((function(callback){return callback===cb}));this.callbacks.splice(idx,1)}},{key:"toString",value:function toString(){return this.name}}]),Event}(),eventDispatcher_EventDispatcher=function(){function EventDispatcher(){Object(classCallCheck.a)(this,EventDispatcher),this.events=void 0,this.events={}}return Object(createClass.a)(EventDispatcher,[{key:"emit",value:function emit(name){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];this.events[name]&&this.events[name].callbacks.forEach((function(cb){cb.apply(void 0,args)}))}},{key:"addEventListener",value:function addEventListener(name,cb){this.events[name]||(this.events[name]=new eventDispatcher_Event(name)),this.events[name].on(cb)}},{key:"removeEventListener",value:function removeEventListener(name,cb){cb?this.events[name].off(cb):delete this.events[name]}}]),EventDispatcher}();function addEvent(el,type,fn,capturing){return el.addEventListener(type,fn,capturing)}function removeEvent(el,type,fn,capturing){return el.removeEventListener(type,fn,capturing)}var MouseMode,ButtonDirection,touch={mouseup:"touchend",mouseout:"touchend",mousedown:"touchstart",mousemove:"touchmove"};function touchy(el,event,type,fn){event(el,touch[type],fn),event(el,type,fn)}!function(MouseMode){MouseMode.DRAWING="DRAWING",MouseMode.PANNING="PANNING",MouseMode.EXTENDING="EXTENDING",MouseMode.NULL="NULL"}(MouseMode||(MouseMode={})),function(ButtonDirection){ButtonDirection.TOP="TOP",ButtonDirection.BOTTOM="BOTTOM",ButtonDirection.LEFT="LEFT",ButtonDirection.RIGHT="RIGHT",ButtonDirection.NULL="NULL"}(ButtonDirection||(ButtonDirection={}));var Canvas_Canvas=function(_EventDispatcher){Object(inherits.a)(Canvas,_EventDispatcher);var _startResetPanZoom,_super=Object(createSuper.a)(Canvas);function Canvas(canvas){var _this;return Object(classCallCheck.a)(this,Canvas),(_this=_super.call(this)).MAX_SCALE=1.5,_this.MIN_SCALE=.3,_this.ZOOM_SENSITIVITY=200,_this.buttonHeight=20,_this.buttonMargin=_this.buttonHeight/2+5,_this.element=void 0,_this.gridSquareLength=20,_this.origin={x:0,y:0},_this.pinchZoomPrevDiff=0,_this.mouseMode=MouseMode.NULL,_this.hoveredButton=null,_this.data=new Map,_this.history=[],_this.panZoom={scale:1,offset:_this.origin},_this.panPoint={lastMousePos:_this.origin},_this.extensionPoint={lastMousePos:_this.origin,direction:null},_this.width=0,_this.height=0,_this.dpr=1,_this.ctx=void 0,_this.handleExtension=function(evt){evt.preventDefault();var minAmountForExtension=_this.gridSquareLength/2;if(!(window.TouchEvent&&evt instanceof TouchEvent&&evt.touches.length>1)){var mouseCartCoord=_this.getMouseCartCoord(evt),buttonDirection=_this.extensionPoint.direction,extensionAmount=diffPoints(_this.extensionPoint.lastMousePos,mouseCartCoord);if(buttonDirection){switch(buttonDirection){case ButtonDirection.TOP:extensionAmount.y>minAmountForExtension?(_this.extendGrid(ButtonDirection.TOP),_this.extensionPoint.lastMousePos.y-=_this.gridSquareLength/2):extensionAmount.y<-minAmountForExtension&&(_this.shortenGrid(ButtonDirection.TOP),_this.extensionPoint.lastMousePos.y+=_this.gridSquareLength/2);break;case ButtonDirection.BOTTOM:extensionAmount.y<-minAmountForExtension?(_this.extendGrid(ButtonDirection.BOTTOM),_this.extensionPoint.lastMousePos.y+=_this.gridSquareLength/2):extensionAmount.y>minAmountForExtension&&(_this.shortenGrid(ButtonDirection.BOTTOM),_this.extensionPoint.lastMousePos.y-=_this.gridSquareLength/2);break;case ButtonDirection.LEFT:extensionAmount.x>minAmountForExtension?(_this.extendGrid(ButtonDirection.LEFT),_this.extensionPoint.lastMousePos.x-=_this.gridSquareLength/2):extensionAmount.x<-minAmountForExtension&&(_this.shortenGrid(ButtonDirection.LEFT),_this.extensionPoint.lastMousePos.x+=_this.gridSquareLength/2);break;case ButtonDirection.RIGHT:extensionAmount.x<-minAmountForExtension?(_this.extendGrid(ButtonDirection.RIGHT),_this.extensionPoint.lastMousePos.x+=_this.gridSquareLength/2):extensionAmount.x>minAmountForExtension&&(_this.shortenGrid(ButtonDirection.RIGHT),_this.extensionPoint.lastMousePos.x-=_this.gridSquareLength/2)}_this.render()}}},_this.handlePanning=function(evt){var lastMousePos=_this.panPoint.lastMousePos;if(!(window.TouchEvent&&evt instanceof TouchEvent&&evt.touches.length>1)){var point=_this.getPointFromTouchyEvent(evt),currentMousePos={x:point.offsetX,y:point.offsetY};_this.panPoint.lastMousePos=currentMousePos;var mouseDiff=diffPoints(lastMousePos,currentMousePos),offset=diffPoints(_this.panZoom.offset,mouseDiff);_this.setPanZoom({offset:offset})}},_this.returnScrollOffsetFromMouseOffset=function(mouseOffset,panZoom,newScale){var scaleOffset=diffPoints(mouseOffset,getScreenPoint(getWorldPoint(mouseOffset,panZoom),{scale:newScale,offset:panZoom.offset}));return addPoints(panZoom.offset,scaleOffset)},_this.handleWheel=function(e){if(e.preventDefault(),e.ctrlKey){var zoom=1-e.deltaY/_this.ZOOM_SENSITIVITY,newScale=_this.panZoom.scale*zoom;newScale>_this.MAX_SCALE&&(newScale=_this.MAX_SCALE),newScale<_this.MIN_SCALE&&(newScale=_this.MIN_SCALE);var mouseOffset={x:e.offsetX,y:e.offsetY},newOffset=_this.returnScrollOffsetFromMouseOffset(mouseOffset,_this.panZoom,newScale);_this.setPanZoom({scale:newScale,offset:newOffset})}else{var offset=diffPoints(_this.panZoom.offset,{x:e.deltaX,y:e.deltaY});_this.setPanZoom(Object(objectSpread2.a)(Object(objectSpread2.a)({},_this.panZoom),{},{offset:offset}))}},_this.handlePinchZoom=function(evt){if(window.TouchEvent&&evt instanceof TouchEvent){var touchCount=evt.touches.length;if(touchCount<2)return;for(var canvasTouchEventIndexes=[],i=0;i<touchCount;i++){evt.touches.item(i).target instanceof HTMLCanvasElement&&canvasTouchEventIndexes.push(i)}if(2!==canvasTouchEventIndexes.length)return;var firstTouch=evt.touches[canvasTouchEventIndexes[0]],secondTouch=evt.touches[canvasTouchEventIndexes[1]],pinchZoomCurrentDiff=Math.abs(firstTouch.clientX-secondTouch.clientX)+Math.abs(firstTouch.clientY-secondTouch.clientY),firstTouchPoint=_this.getPointFromTouch(firstTouch),secondTouchPoint=_this.getPointFromTouch(secondTouch),touchCenterPos={x:(firstTouchPoint.offsetX+secondTouchPoint.offsetY)/2,y:(firstTouchPoint.offsetY+secondTouchPoint.offsetY)/2};if(!_this.pinchZoomPrevDiff)return void(_this.pinchZoomPrevDiff=pinchZoomCurrentDiff);var zoom=1-2*(_this.pinchZoomPrevDiff-pinchZoomCurrentDiff)/_this.ZOOM_SENSITIVITY,newScale=_this.panZoom.scale*zoom;if(_this.MIN_SCALE>newScale||newScale>_this.MAX_SCALE)return;var scaleOffset=diffPoints(touchCenterPos,getScreenPoint(getWorldPoint(touchCenterPos,{scale:_this.panZoom.scale,offset:_this.panZoom.offset}),{scale:newScale,offset:_this.panZoom.offset})),offset=addPoints(_this.panZoom.offset,scaleOffset);_this.setPanZoom({offset:offset,scale:newScale}),_this.pinchZoomPrevDiff=pinchZoomCurrentDiff}},_this.element=canvas,_this.ctx=canvas.getContext("2d"),_this.initialize(),_this}return Object(createClass.a)(Canvas,[{key:"detectMouseOnButton",value:function detectMouseOnButton(coord){var gridsHeight=this.gridSquareLength*this.getRowCount(),gridsWidth=this.gridSquareLength*this.getColumnCount(),topButtonPos={x:-gridsWidth/2,y:-gridsHeight/2-this.buttonMargin-this.buttonHeight/2},bottomButtonPos={x:-gridsWidth/2,y:gridsHeight/2+this.buttonMargin-this.buttonHeight/2},leftButtonPos={x:-gridsWidth/2-this.buttonMargin-this.buttonHeight/2,y:-gridsHeight/2},rightButtonPos={x:gridsWidth/2+this.buttonMargin-this.buttonHeight/2,y:-gridsHeight/2},x=coord.x,y=coord.y,topButtonRect_x=topButtonPos.x,topButtonRect_y=topButtonPos.y,topButtonRect_width=gridsWidth,topButtonRect_height=this.buttonHeight,bottomButtonRect_x=bottomButtonPos.x,bottomButtonRect_y=bottomButtonPos.y,bottomButtonRect_width=gridsWidth,bottomButtonRect_height=this.buttonHeight,leftButtonRect_x=leftButtonPos.x,leftButtonRect_y=leftButtonPos.y,leftButtonRect_width=this.buttonHeight,leftButtonRect_height=gridsHeight,rightButtonRect_x=rightButtonPos.x,rightButtonRect_y=rightButtonPos.y,rightButtonRect_width=this.buttonHeight,rightButtonRect_height=gridsHeight;return x>=topButtonRect_x&&x<=topButtonRect_x+topButtonRect_width&&y>=topButtonRect_y&&y<=topButtonRect_y+topButtonRect_height?ButtonDirection.TOP:x>=bottomButtonRect_x&&x<=bottomButtonRect_x+bottomButtonRect_width&&y>=bottomButtonRect_y&&y<=bottomButtonRect_y+bottomButtonRect_height?ButtonDirection.BOTTOM:x>=leftButtonRect_x&&x<=leftButtonRect_x+leftButtonRect_width&&y>=leftButtonRect_y&&y<=leftButtonRect_y+leftButtonRect_height?ButtonDirection.LEFT:x>=rightButtonRect_x&&x<=rightButtonRect_x+rightButtonRect_width&&y>=rightButtonRect_y&&y<=rightButtonRect_y+rightButtonRect_height?ButtonDirection.RIGHT:null}},{key:"detectButtonClicked",value:function detectButtonClicked(coord){return this.detectMouseOnButton(coord)}},{key:"drawTopButton",value:function drawTopButton(opacity){var gridsWidth=this.gridSquareLength*this.getColumnCount(),gridsHeight=this.gridSquareLength*this.getRowCount(),ctx=this.ctx;ctx.save();var buttonPos={x:-gridsWidth/2,y:-gridsHeight/2-this.buttonMargin},correctedScreenPoint=getScreenPoint(convertCartesianToScreen(this.element,buttonPos,this.dpr),this.panZoom);ctx.fillStyle="#E1DFE1",ctx.globalAlpha=opacity,ctx.fillRect(correctedScreenPoint.x,correctedScreenPoint.y-this.buttonHeight/2*this.panZoom.scale,gridsWidth*this.panZoom.scale,this.buttonHeight*this.panZoom.scale),ctx.restore()}},{key:"drawBottomButton",value:function drawBottomButton(opacity){var ctx=this.ctx;ctx.save();var gridsWidth=this.gridSquareLength*this.getColumnCount(),buttonPos={x:-gridsWidth/2,y:this.gridSquareLength*this.getRowCount()/2+this.buttonMargin},correctedScreenPoint=getScreenPoint(convertCartesianToScreen(this.element,buttonPos,this.dpr),this.panZoom);ctx.fillStyle="#E1DFE1",ctx.globalAlpha=opacity,ctx.fillRect(correctedScreenPoint.x,correctedScreenPoint.y-this.buttonHeight/2*this.panZoom.scale,gridsWidth*this.panZoom.scale,this.buttonHeight*this.panZoom.scale),ctx.restore()}},{key:"drawLeftButton",value:function drawLeftButton(opacity){var ctx=this.ctx;ctx.save();var gridsWidth=this.gridSquareLength*this.getColumnCount(),gridsHeight=this.gridSquareLength*this.getRowCount(),buttonPos={x:-gridsWidth/2-this.buttonMargin,y:-gridsHeight/2},correctedScreenPoint=getScreenPoint(convertCartesianToScreen(this.element,buttonPos,this.dpr),this.panZoom);ctx.fillStyle="#E1DFE1",ctx.globalAlpha=opacity,ctx.fillRect(correctedScreenPoint.x-this.buttonHeight/2*this.panZoom.scale,correctedScreenPoint.y,this.buttonHeight*this.panZoom.scale,gridsHeight*this.panZoom.scale),ctx.restore()}},{key:"drawRightButton",value:function drawRightButton(opacity){var ctx=this.ctx;ctx.save();var gridsWidth=this.gridSquareLength*this.getColumnCount(),gridsHeight=this.gridSquareLength*this.getRowCount(),buttonPos={x:gridsWidth/2+this.buttonMargin,y:-gridsHeight/2},correctedScreenPoint=getScreenPoint(convertCartesianToScreen(this.element,buttonPos,this.dpr),this.panZoom);ctx.fillStyle="#E1DFE1",ctx.globalAlpha=opacity,ctx.fillRect(correctedScreenPoint.x-this.buttonHeight/2*this.panZoom.scale,correctedScreenPoint.y,this.buttonHeight*this.panZoom.scale,gridsHeight*this.panZoom.scale),ctx.restore()}},{key:"drawButtons",value:function drawButtons(){this.drawTopButton(this.hoveredButton===ButtonDirection.TOP?.8:.4),this.drawBottomButton(this.hoveredButton===ButtonDirection.BOTTOM?.8:.4),this.drawLeftButton(this.hoveredButton===ButtonDirection.LEFT?.8:.4),this.drawRightButton(this.hoveredButton===ButtonDirection.RIGHT?.8:.4)}},{key:"drawRects",value:function drawRects(){var squareLength=this.gridSquareLength*this.panZoom.scale,leftTopPoint={x:-this.getColumnCount()/2*this.gridSquareLength,y:-this.getRowCount()/2*this.gridSquareLength},ctx=this.ctx,correctedLeftTopScreenPoint=getScreenPoint(convertCartesianToScreen(this.element,leftTopPoint,this.dpr),this.panZoom);ctx.save();for(var allRowKeys=Array.from(this.data.keys()),allColumnKeys=Array.from(this.data.get(allRowKeys[0]).keys()),currentTopIndex=Math.min.apply(Math,allRowKeys),currentLeftIndex=Math.min.apply(Math,allColumnKeys),i=0;i<this.getRowCount();i++)for(var j=0;j<this.getColumnCount();j++){var _this$data$get,_this$data$get$get,rowIndex=i+currentTopIndex,columnIndex=j+currentLeftIndex,color=(null===(_this$data$get=this.data.get(rowIndex))||void 0===_this$data$get||null===(_this$data$get$get=_this$data$get.get(columnIndex))||void 0===_this$data$get$get?void 0:_this$data$get$get.color)||"white";ctx.fillStyle=color,ctx.fillRect(j*squareLength+correctedLeftTopScreenPoint.x,i*squareLength+correctedLeftTopScreenPoint.y,squareLength,squareLength)}ctx.restore()}},{key:"drawGrids",value:function drawGrids(){var squareLength=this.gridSquareLength*this.panZoom.scale,leftTopPoint={x:-this.getColumnCount()/2*this.gridSquareLength,y:-this.getRowCount()/2*this.gridSquareLength},ctx=this.ctx,correctedScreenPoint=getScreenPoint(convertCartesianToScreen(this.element,leftTopPoint,this.dpr),this.panZoom);ctx.save(),ctx.lineWidth=1;for(var i=0;i<=this.getColumnCount();i++)ctx.beginPath(),ctx.moveTo(correctedScreenPoint.x+i*squareLength,correctedScreenPoint.y),ctx.lineTo(correctedScreenPoint.x+i*squareLength,correctedScreenPoint.y+this.getRowCount()*squareLength),ctx.stroke(),ctx.closePath();for(var j=0;j<=this.getRowCount();j++)ctx.beginPath(),ctx.moveTo(correctedScreenPoint.x,correctedScreenPoint.y+j*squareLength),ctx.lineTo(correctedScreenPoint.x+this.getColumnCount()*squareLength,correctedScreenPoint.y+j*squareLength),ctx.stroke(),ctx.closePath();ctx.restore()}},{key:"getData",value:function getData(){return this.data}},{key:"reset",value:function reset(){this.scale(1,1),this.panZoom={scale:1,offset:this.origin},this.clear()}},{key:"getContext",value:function getContext(){return this.ctx}},{key:"getPanZoom",value:function getPanZoom(){return this.panZoom}},{key:"getCanvasElement",value:function getCanvasElement(){return this.element}},{key:"getDpr",value:function getDpr(){return this.dpr}},{key:"initialize",value:function initialize(){this.onMouseUp=this.onMouseUp.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),touchy(this.element,addEvent,"mousedown",this.onMouseDown),touchy(this.element,addEvent,"mouseup",this.onMouseUp),touchy(this.element,addEvent,"mouseout",this.onMouseOut),touchy(this.element,addEvent,"mousemove",this.onMouseMove),this.element.addEventListener("wheel",this.handleWheel);for(var i=0;i<6;i++){this.data.set(i,new Map);for(var j=0;j<8;j++)this.data.get(i).set(j,{color:""})}}},{key:"getMouseCartCoord",value:function getMouseCartCoord(evt){evt.preventDefault();var point=this.getPointFromTouchyEvent(evt);return diffPoints(getWorldPoint({x:point.offsetX,y:point.offsetY},this.panZoom),{x:this.element.width/this.dpr/2,y:this.element.height/this.dpr/2})}},{key:"drawPixelFromCartCoord",value:function drawPixelFromCartCoord(mouseCartCoord){var leftTopPoint_x=-this.getColumnCount()/2*this.gridSquareLength,leftTopPoint_y=-this.getRowCount()/2*this.gridSquareLength,isMouseInGrid=!1;if(mouseCartCoord.x>leftTopPoint_x&&mouseCartCoord.x<leftTopPoint_x+this.getColumnCount()*this.gridSquareLength&&mouseCartCoord.y>leftTopPoint_y&&mouseCartCoord.y<leftTopPoint_y+this.getRowCount()*this.gridSquareLength){var allRowKeys=Array.from(this.data.keys()),allColumnKeys=Array.from(this.data.get(allRowKeys[0]).keys()),currentTopIndex=Math.min.apply(Math,allRowKeys),currentLeftIndex=Math.min.apply(Math,allColumnKeys),rowOffset=Math.floor((mouseCartCoord.y-leftTopPoint_y)/this.gridSquareLength),columnOffset=Math.floor((mouseCartCoord.x-leftTopPoint_x)/this.gridSquareLength);isMouseInGrid=!0,this.data.get(currentTopIndex+rowOffset).set(currentLeftIndex+columnOffset,{color:"#ff0000"}),this.render()}return isMouseInGrid}},{key:"onMouseDown",value:function onMouseDown(evt){evt.preventDefault();var point=this.getPointFromTouchyEvent(evt);this.panPoint.lastMousePos={x:point.offsetX,y:point.offsetY};var mouseCartCoord=this.getMouseCartCoord(evt),isMouseInGrid=this.drawPixelFromCartCoord(mouseCartCoord),buttonDirection=this.detectButtonClicked(mouseCartCoord);this.mouseMode=isMouseInGrid?MouseMode.DRAWING:MouseMode.PANNING,buttonDirection&&(this.extensionPoint.lastMousePos={x:mouseCartCoord.x,y:mouseCartCoord.y},this.extensionPoint.direction=buttonDirection,this.mouseMode=MouseMode.EXTENDING,touchy(this.element,addEvent,"mousemove",this.handleExtension)),this.mouseMode===MouseMode.PANNING&&(touchy(this.element,addEvent,"mousemove",this.handlePanning),touchy(this.element,addEvent,"mousemove",this.handlePinchZoom))}},{key:"extendGrid",value:function extendGrid(direction){var currentRowCount=this.getRowCount(),currentColumnCount=this.getColumnCount(),allRowKeys=Array.from(this.data.keys()),allColumnKeys=Array.from(this.data.get(allRowKeys[0]).keys()),currentTopIndex=Math.min.apply(Math,allRowKeys),currentLeftIndex=Math.min.apply(Math,allColumnKeys),currentBottomIndex=currentTopIndex+currentRowCount-1,currentRightIndex=currentLeftIndex+currentColumnCount-1;switch(direction){case ButtonDirection.TOP:var newTopIndex=currentTopIndex-1;this.data.set(newTopIndex,new Map);for(var i=currentLeftIndex;i<=currentRightIndex;i++)this.data.get(newTopIndex).set(i,{color:""});this.setPanZoom({offset:{x:this.panZoom.offset.x,y:this.panZoom.offset.y-this.gridSquareLength/2*this.panZoom.scale}});break;case ButtonDirection.BOTTOM:var newBottomIndex=currentBottomIndex+1;this.data.set(newBottomIndex,new Map);for(var _i=currentLeftIndex;_i<=currentRightIndex;_i++)this.data.get(newBottomIndex).set(_i,{color:""});this.setPanZoom({offset:{x:this.panZoom.offset.x,y:this.panZoom.offset.y+this.gridSquareLength/2*this.panZoom.scale}});break;case ButtonDirection.LEFT:var newLeftIndex=currentLeftIndex-1;this.data.forEach((function(row){row.set(newLeftIndex,{color:""})})),this.setPanZoom({offset:{x:this.panZoom.offset.x-this.gridSquareLength/2*this.panZoom.scale,y:this.panZoom.offset.y}});break;case ButtonDirection.RIGHT:var newRightIndex=currentRightIndex+1;this.data.forEach((function(row){row.set(newRightIndex,{color:""})})),this.setPanZoom({offset:{x:this.panZoom.offset.x+this.gridSquareLength/2*this.panZoom.scale,y:this.panZoom.offset.y}})}this.render()}},{key:"shortenGrid",value:function shortenGrid(direction){var allRowKeys=Array.from(this.data.keys()),allColumnKeys=Array.from(this.data.get(allRowKeys[0]).keys()),currentTopIndex=Math.min.apply(Math,allRowKeys),currentLeftIndex=Math.min.apply(Math,allColumnKeys),currentBottomIndex=currentTopIndex+this.getRowCount()-1,currentRightIndex=currentLeftIndex+this.getColumnCount()-1;switch(direction){case ButtonDirection.TOP:if(allRowKeys.length<=2)break;this.data.delete(currentTopIndex),this.setPanZoom({offset:{x:this.panZoom.offset.x,y:this.panZoom.offset.y+this.gridSquareLength/2*this.panZoom.scale}});break;case ButtonDirection.BOTTOM:if(allRowKeys.length<=2)break;this.data.delete(currentBottomIndex),this.setPanZoom({offset:{x:this.panZoom.offset.x,y:this.panZoom.offset.y-this.gridSquareLength/2*this.panZoom.scale}});break;case ButtonDirection.LEFT:if(allColumnKeys.length<=2)break;this.data.forEach((function(row){row.delete(currentLeftIndex)})),this.setPanZoom({offset:{x:this.panZoom.offset.x+this.gridSquareLength/2*this.panZoom.scale,y:this.panZoom.offset.y}});break;case ButtonDirection.RIGHT:if(allColumnKeys.length<=2)break;this.data.forEach((function(row){row.delete(currentRightIndex)})),this.setPanZoom({offset:{x:this.panZoom.offset.x-this.gridSquareLength/2*this.panZoom.scale,y:this.panZoom.offset.y}})}this.render()}},{key:"onMouseMove",value:function onMouseMove(evt){if(evt.preventDefault(),this.mouseMode!==MouseMode.DRAWING){var mouseCartCoord=this.getMouseCartCoord(evt),buttonDirection=this.detectMouseOnButton(mouseCartCoord);if(buttonDirection)return this.hoveredButton=buttonDirection,void this.render();this.mouseMode!==MouseMode.EXTENDING&&(this.hoveredButton=null),this.render()}else{var _mouseCartCoord=this.getMouseCartCoord(evt);this.drawPixelFromCartCoord(_mouseCartCoord)}}},{key:"removePanListeners",value:function removePanListeners(){touchy(this.element,removeEvent,"mousemove",this.handlePanning),touchy(this.element,removeEvent,"mousemove",this.handlePinchZoom)}},{key:"onMouseUp",value:function onMouseUp(){this.mouseMode=MouseMode.NULL,touchy(this.element,removeEvent,"mousemove",this.handlePanning),touchy(this.element,removeEvent,"mousemove",this.handlePinchZoom),touchy(this.element,removeEvent,"mousemove",this.handleExtension),this.pinchZoomPrevDiff=void 0,this.hoveredButton=null}},{key:"onMouseOut",value:function onMouseOut(){this.mouseMode!==MouseMode.PANNING&&(touchy(this.element,removeEvent,"mousemove",this.handleExtension),touchy(this.element,removeEvent,"mousemove",this.handlePanning),touchy(this.element,removeEvent,"mousemove",this.handlePinchZoom),this.hoveredButton=null)}},{key:"getColumnCount",value:function getColumnCount(){return 0===this.data.size?0:this.data.entries().next().value[1].size}},{key:"getRowCount",value:function getRowCount(){return this.data.size}},{key:"setPanZoom",value:function setPanZoom(param){this.emit("setIsPanZoomed");var scale=param.scale,offset=param.offset;if(scale&&(this.panZoom.scale=scale),offset){var correctedOffset=Object(objectSpread2.a)({},offset),columnCount=this.data.entries().next().value[1].size,rowCount=this.data.size,isGridRowsBiggerThanCanvas=rowCount*this.gridSquareLength*this.panZoom.scale>this.height,isGridColumnsBiggerThanCanvas=columnCount*this.gridSquareLength*this.panZoom.scale>this.width,minXPosition=isGridColumnsBiggerThanCanvas?this.width-columnCount*this.gridSquareLength*this.panZoom.scale-(this.width-columnCount*this.gridSquareLength)*this.panZoom.scale/2:-(this.width-columnCount*this.gridSquareLength)/2*this.panZoom.scale,minYPosition=isGridRowsBiggerThanCanvas?this.height-rowCount*this.gridSquareLength*this.panZoom.scale-(this.height-rowCount*this.gridSquareLength)*this.panZoom.scale/2:-(this.height-rowCount*this.gridSquareLength)/2*this.panZoom.scale,maxXPosition=isGridColumnsBiggerThanCanvas?-(this.width-columnCount*this.gridSquareLength)/2*this.panZoom.scale:this.width-columnCount*this.gridSquareLength*this.panZoom.scale-(this.width-columnCount*this.gridSquareLength)*this.panZoom.scale/2,maxYPosition=isGridRowsBiggerThanCanvas?rowCount*this.gridSquareLength*this.panZoom.scale/2-this.height/2*this.panZoom.scale:this.height-rowCount*this.gridSquareLength*this.panZoom.scale-(this.height-rowCount*this.gridSquareLength)*this.panZoom.scale/2;correctedOffset.x<minXPosition&&(correctedOffset.x=minXPosition),correctedOffset.y<minYPosition&&(correctedOffset.y=minYPosition),correctedOffset.x>maxXPosition&&(correctedOffset.x=maxXPosition),correctedOffset.y>maxYPosition&&(correctedOffset.y=maxYPosition),this.panZoom.offset=correctedOffset}this.render()}},{key:"startResetPanZoom",value:(_startResetPanZoom=Object(asyncToGenerator.a)(Object(regeneratorRuntime.a)().mark((function _callee(){return Object(regeneratorRuntime.a)().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:this.destroy(),this.initialize();case 2:case"end":return _context.stop()}}),_callee,this)}))),function startResetPanZoom(){return _startResetPanZoom.apply(this,arguments)})},{key:"setMouseMode",value:function setMouseMode(mode){this.mouseMode=mode}},{key:"getPointFromTouch",value:function getPointFromTouch(touch){var r=this.element.getBoundingClientRect(),originY=touch.clientY,originX=touch.clientX,offsetX=touch.clientX-r.left,offsetY=touch.clientY-r.top;return{x:originX-this.panZoom.offset.x,y:originY-this.panZoom.offset.y,offsetX:offsetX,offsetY:offsetY}}},{key:"getPointFromTouchyEvent",value:function getPointFromTouchyEvent(evt){var originY,originX,offsetX,offsetY;if(window.TouchEvent&&evt instanceof TouchEvent){for(var isCanvasTouchIncluded=!1,firstCanvasTouchIndex=0,i=0;i<evt.touches.length;i++){if(evt.touches.item(i).target instanceof HTMLCanvasElement){isCanvasTouchIncluded=!0,firstCanvasTouchIndex=i;break}}return isCanvasTouchIncluded?this.getPointFromTouch(evt.touches[firstCanvasTouchIndex]):this.getPointFromTouch(evt.touches[0])}return originY=evt.clientY,originX=evt.clientX,offsetX=evt.offsetX,offsetY=evt.offsetY,originY+=window.scrollY,originX+=window.scrollX,{y:originY-this.panZoom.offset.y,x:originX-this.panZoom.offset.x,offsetX:offsetX,offsetY:offsetY}}},{key:"getWidth",value:function getWidth(){return this.width}},{key:"getHeight",value:function getHeight(){return this.height}},{key:"setWidth",value:function setWidth(width,devicePixelRatio){this.width=width,this.element.width=devicePixelRatio?width*devicePixelRatio:width,this.element.style.width="".concat(width,"px")}},{key:"setHeight",value:function setHeight(height,devicePixelRatio){this.height=height,this.element.height=devicePixelRatio?height*devicePixelRatio:height,this.element.style.height="".concat(height,"px")}},{key:"setSize",value:function setSize(width,height,devicePixelRatio){this.setWidth(width,devicePixelRatio),this.setHeight(height,devicePixelRatio),this.dpr=devicePixelRatio||this.dpr}},{key:"scale",value:function scale(x,y){this.ctx.scale(x,y)}},{key:"roundRect",value:function roundRect(x,y,width,height,radius){var ctx=this.ctx;ctx.save(),ctx.fillStyle="#FF7C7C",ctx.beginPath(),ctx.moveTo(x+radius,y),ctx.arcTo(x+width,y,x+width,y+height,radius),ctx.arcTo(x+width,y+height,x,y+height,radius),ctx.arcTo(x,y+height,x,y,radius),ctx.arcTo(x,y,x+width,y,radius),ctx.closePath(),ctx.fill(),ctx.restore()}},{key:"render",value:function render(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.save(),this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.restore(),this.drawRects(),this.drawGrids(),this.drawButtons()}},{key:"clear",value:function clear(){var rowCount=this.getRowCount(),columnCount=this.getColumnCount();this.data=new Map;for(var i=0;i<rowCount;i++){this.data.set(i,new Map);for(var j=0;j<columnCount;j++)this.data.get(i).set(j,{color:""})}this.render()}},{key:"destroy",value:function destroy(){touchy(this.element,removeEvent,"mouseup",this.onMouseUp),touchy(this.element,removeEvent,"mouseout",this.onMouseOut),touchy(this.element,removeEvent,"mousedown",this.onMouseDown),touchy(this.element,removeEvent,"mousemove",this.onMouseMove),touchy(this.element,removeEvent,"mousemove",this.handlePanning),touchy(this.element,removeEvent,"mousemove",this.handlePinchZoom),this.element.removeEventListener("wheel",this.handleWheel)}}]),Canvas}(eventDispatcher_EventDispatcher);var Canvas_useCanvas=function useCanvas(_ref){var divRef=_ref.divRef,canvasRef=_ref.canvasRef,onSetIsPanZoomedCallBack=_ref.onSetIsPanZoomedCallBack,_useState=Object(react.useState)(null),_useState2=Object(slicedToArray.a)(_useState,2),canvas=_useState2[0],setCanvas=_useState2[1];return Object(react.useEffect)((function(){if(canvasRef.current){var graphCanvasObject=new Canvas_Canvas(canvasRef.current);setCanvas(graphCanvasObject)}}),[canvasRef]),Object(react.useEffect)((function(){var onResize=function onResize(){if(divRef.current&&canvas){var dpr=window.devicePixelRatio,rect=divRef.current.getBoundingClientRect();canvas.setSize(rect.width,rect.height,dpr),canvas.scale(dpr,dpr),canvas.render()}};return onResize(),window.addEventListener("mouseup",(function onMouseUp(){canvas&&(canvas.setMouseMode(MouseMode.NULL),canvas.removePanListeners())})),window.addEventListener("resize",onResize),null==canvas||canvas.addEventListener("setIsPanZoomed",onSetIsPanZoomedCallBack),function(){window.removeEventListener("resize",onResize),null==canvas||canvas.removeEventListener("setIsPanZoomed",onSetIsPanZoomedCallBack)}}),[canvas,divRef,onSetIsPanZoomedCallBack]),canvas},Dotter_Dotter=Object(react.forwardRef)((function Dotter(props,ref){var containerRef=Object(react.useRef)(null),_useState=Object(react.useState)(null),_useState2=Object(slicedToArray.a)(_useState,2),canvas=_useState2[0],setCanvas=_useState2[1];Object(react.useEffect)((function(){var onResize=function onResize(){if(containerRef.current&&canvas){var dpr=window.devicePixelRatio,rect=containerRef.current.getBoundingClientRect();canvas.setSize(rect.width,rect.height,dpr),canvas.scale(dpr,dpr),canvas.render()}};return onResize(),window.addEventListener("resize",onResize),function(){window.removeEventListener("resize",onResize)}}),[canvas,containerRef]);var gotRef=Object(react.useCallback)((function(canvasRef){if(canvasRef){var canvas=new Canvas_Canvas(canvasRef);setCanvas(canvas)}}),[history]),clear=Object(react.useCallback)((function(){canvas&&canvas.clear()}),[canvas]);return Object(react.useImperativeHandle)(ref,(function(){return{download:function download(){canvas&&document.createElement("a").click()},clear:clear}}),[canvas]),react_default.a.createElement("div",{style:{width:props.width,height:props.height},ref:containerRef},react_default.a.createElement("canvas",{ref:gotRef,style:{border:"1px solid black"}}))})),Dotter_stories_Primary=(__webpack_exports__.default={title:"Dotting",component:Canvas_useCanvas},function Primary(){var dotterRef=Object(react.useRef)(null);return react_default.a.createElement("div",{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},react_default.a.createElement("button",{onClick:function onClick(){var _dotterRef$current;null===(_dotterRef$current=dotterRef.current)||void 0===_dotterRef$current||_dotterRef$current.clear()}},"clear"),react_default.a.createElement(Dotter_Dotter,{ref:dotterRef,width:500,height:300}))})},"./storybook-init-framework-entry.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__("./node_modules/@storybook/react/dist/esm/client/index.js")},0:function(module,exports,__webpack_require__){__webpack_require__("./node_modules/@storybook/core-client/dist/esm/globals/polyfills.js"),__webpack_require__("./node_modules/@storybook/core-client/dist/esm/globals/globals.js"),__webpack_require__("./storybook-init-framework-entry.js"),__webpack_require__("./node_modules/@storybook/react/dist/esm/client/preview/config-generated-config-entry.js"),module.exports=__webpack_require__("./generated-stories-entry.js")},1:function(module,exports){}},[[0,2,3]]]);